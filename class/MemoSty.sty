%%%% memo variabls


\NewDocumentCommand{\memoTo}{m o o o o}{
\gdef\@memoToA{#1}
\IfValueT{#2}{\gdef\@memoToB{#2}}
\IfValueT{#3}{\gdef\@memoToC{#3}}
\IfValueT{#4}{\gdef\@memoToD{#4}}
\IfValueT{#5}{\gdef\@memoToE{#5}}
}
\NewDocumentCommand{\memoFr}{m o o o o}{
\gdef\@memoFrA{#1}
\IfValueT{#2}{\gdef\@memoFrB{#2}}
\IfValueT{#3}{\gdef\@memoFrC{#3}}
\IfValueT{#4}{\gdef\@memoFrD{#4}}
\IfValueT{#5}{\gdef\@memoFrE{#5}}
}

\providecommand{\@memoTo}{}
\providecommand{\@memoFr}{}
\providecommand{\@memoFrAddr}{}
\providecommand{\@memoToAddr}{}

\def\@memoHeader{}
\newcommand{\memoHeader}[1]{\gdef\@memoHeader{#1}}
\newcommand{\fileno}[1]{\gdef\@fileno{#1}}
\newcommand{\attachments}[1]{\gdef\@attachments{#1}}

\newcommand{\@HangingLabel}[1]{\leavevmode\llap{\scriptsize\uppercase{#1}:\enspace}}

%    	\ifdefOR{\@memoToB}{\@memoFrB}{\ifdef{\@memoToB}{\@memoToB}{}	&&   \ifdef{\@memoFrB}{\@memoFrB}{}	 \\}{}
%    	\ifdefOR{\@memoToC}{\@memoFrC}{\ifdef{\@memoToC}{\@memoToC}{}	&&   \ifdef{\@memoFrC}{\@memoFrC}{}	 \\}{}
%    	\ifdefOR{\@memoToD}{\@memoFrD}{\ifdef{\@memoToD}{\@memoToD}{}	&&   \ifdef{\@memoFrD}{\@memoFrD}{}	 \\}{}
%    	\ifdefOR{\@memoToE}{\@memoFrE}{\ifdef{\@memoToE}{\@memoToE}{}	&&   \ifdef{\@memoFrE}{\@memoFrE}{}	 \\}{}
    %

\gdef\makeMemotitle{%
    \thispagestyle{plain}
    \vspace*{-4.5em}
    \ifdef{\@memoHeader}{\vspace*{-2em}  \ \hfill {\large\bfseries \@memoHeader } \hfill \  \\[1.2em]}{}
    \begin{tabularx}{\textwidth}{lXl}
    	\@HangingLabel{to}\textit{\@memoTo}  &&
    	      \@HangingLabel{fr}\textit{\@memoFr}\\ \noalign{\vskip 0.5mm} % add a bit more space %%% todo need an ifdefOR{\cs1}{\cs2}{}{}
      \makecell[tl]{\@memoToAddr{}}  && \makecell[tl]{\@memoFrAddr{}} \\
    	\\\noalign{\vskip -1.3ex}
    	\midrule
    \end{tabularx}
    \par

    \vspace*{1em}

    \parbox{\linewidth}{\setstretch{1.3}
    	\ifdef{\@subject}{\@HangingLabel{subject}\raggedright\textbf{\Large\@subject}\\[8pt]}{}%
    	\ifdef{\@date}{\@HangingLabel{date}\textbf{\Large\@date}\\[8pt]}{}
    	\ifdef{\@fileno}{\@HangingLabel{file}\textbf{\Large\@fileno}\\[8pt]}{}
    	\ifdef{\@attachments}{\@HangingLabel{attached}\@attachments\\[8pt]}{}
    	\par
    }%
}


\iftoggle{useMemo}{

  \AtBeginDocument{
        \ifdef{\@memoToA}{\lohead{\textit\@memoToA}}{}
        \ifdef{\@date}{\rohead{\@date}}{}
        \makeMemotitle
        }

    \togglefalse{SecOnNewPage}         %%% PATCH sections
    \addtokomafont{section}{\color{black}\large}
    \addtokomafont{subsection}{\color{black}\normalsize}
    \addtokomafont{subsubsection}{\color{black}}  % do not use in a memo

    \gdef\scr@section@beforeskip{17.1pt \@plus 1.7pt}
    \gdef\scr@section@afterskip{0.1pt}
    \gdef\scr@subsection@beforeskip{13.1pt \@plus 1.3pt}
    \gdef\scr@subsection@afterskip{0.1pt}


    \setcounter{secnumdepth}{-\maxdimen}  % remove sec num
    \KOMAoptions{bibliography=totoc}  % uncomment if you want numbered reference section
    \floatsetup{objectset=raggedright}
    \captionsetup{labelformat=widecap}
}{}

