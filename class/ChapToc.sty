%
%\usepackage{scrwfile}
%
%\newif\ifusechaptertoc% Switch to tell \addtocentrydefault to not only make entries to the toc-file but also to the current section-toc-file
%\newcommand*{\chaptertoc}[1][\thechapter]{% new command to generate and show a chapter toc
%  \usechaptertoctrue% switch on chapter-toc-entries
%  \edef\ext@subtoc{toc#1}% extension of the section-toc-file, e.g., toc1
%  \DeclareNewTOC{\ext@subtoc}% declare a new toc file
%  \addsec*{Contents}% header of the chaptertoc
%  \begin{minipage}{.9\linewidth}
%    \value{tocdepth}=\subsectiontocdepth% we want entries down to subsection
%    \listoftoc*{\ext@subtoc}% show the toc without header
%  \end{minipage}\par
%  \bigskip\noindent\ignorespaces% add some vertical space after the toc and do not indent the following text
%}
%\xapptocmd\addtocentrydefault{% patch the KOMA-Script's generic toc entry generator
%  \ifusechaptertoc% if chapter toc entries should be generated
%    \expandafter\tocbasic@addxcontentsline\expandafter{\ext@subtoc}{#1}{#2}{#3}% do it
%  \fi
%}{}{}
%\xpretocmd\chapter{\usechaptertocfalse}{}{}% automatically switch of chapter toc entries at start of every \chapter
%
