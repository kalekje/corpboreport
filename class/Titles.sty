%%% document variables

\RenewDocumentCommand{\title}{m}{\luadirect{
	pl.tex.defcmdAT('@title', \luastringN{#1})
	pl.tex.updatePDFtable('Title', pl.tex.makePDFvarstr(\luastringN{#1}), false)
	pl.tex.defcmd('thetitle', pl.tex.makeInTextstr(\luastringN{#1}))
}}

\RenewDocumentCommand{\author}{m}{\luadirect{
	pl.tex.defcmdAT('@author', \luastringN{#1})
	pl.tex.updatePDFtable('Author', pl.tex.makePDFvarstr(\luastringN{#1}), false)
	pl.tex.defcmd('theauthor', pl.tex.makeInTextstr(\luastringN{#1}))
}}

\RenewDocumentCommand{\date}{m}{\luadirect{
	pl.tex.defcmdAT('@date', \luastringN{#1})
	pl.tex.defcmd('thedate', pl.tex.makeInTextstr(\luastringN{#1}))
}
\luaexec{pl.tex.updatePDFtable('Date', os.date'\%Y-\%m-\%d', false)}
}

\NewDocumentCommand{\company}{m}{\luadirect{
	pl.tex.defcmdAT('@publishers', \luastringN{#1})
	pl.tex.updatePDFtable('Publisher', pl.tex.makePDFvarstr(\luastringN{#1}), false)
	pl.tex.defcmd('thecompany', pl.tex.makeInTextstr(\luastringN{#1}))
}}

\let\publishers\company
\let\thepublishers\thecompany
% use @publishers to match KOMA, Publisher for PDFvar
% for beamer, company = institute

\def\@logoset{} % additional logo settings
\NewDocumentCommand\logoset{m}{\gdef\@logoset{#1}}

\NewDocumentCommand{\logo}{ s >{\ExpArgOnceProc}O{\@logoset} m }{%
% star to overwrite custom settings for image, otherwise, try to let the class place it
	\IfBooleanTF{#1}%
	{\gdef\@logo{#3}}%
	{\iftoggle{samepgTitle}%
		{\gdef\@logo{\Llap{\raisebox{\dimexpr(-\height+16pt)\relax}[0pt][0pt]{\includegraphics[width=4cm,#2]{#3}}}}}%
		{\gdef\@logo{\includegraphics[width=4cm,smash=tl,#2]{#3}}}
	}%
}


%%% title pages

\gdef\cpb@tpOwn{
\begin{titlepage} % Suppresses displaying the page number on the title page and the subsequent page counts as page 1
	\toglnums
	\raggedright % Right align the title page
	\rule{\heavyrulewidth}{7.4in} % Vertical line
	\hspace{0.5in} % Whitespace between the vertical line and title page text
	\begin{minipage}[b][7.4in][s]{4.4in}
	    \raggedright

		\null\vfill\null\vfill

		\parbox[t]{\linewidth}{\Huge\bfseries\@title}% Title  \bfseries

		\ifdef{\@subtitle}{
		\null\vfill\par
			\parbox[t]{\linewidth}{\large\itshape\@subtitle} % Subtitle or further description
		}{}
		\ifdef{\@publishers}{\def\and{\\}
			\null\vfill\par
			\parbox[t]{\linewidth}{\Large\@publishers} % or company
		}{}
		\ifdef{\@author}{\def\and{\\}
			\null\vfill\par
			\parbox[t]{\linewidth}{\bfseries\Large\@author}
		}{}
		\ifdef{\@date}{
			\null\vfill\par
			\parbox[t]{\linewidth}{\Large\@date}
		}{}
		\ifdef{\@logo}{
			\null\vfill
			\null\vfill\par
			\null\hfill\@logo\par
		}{}

		\null\vfill\null\vfill
		
\end{minipage}
\end{titlepage}
}




\gdef\cpb@tpSame{\thispagestyle{plain}
		\gdef\And{\hspace*{3ex}}
		\vspace*{-2.5cm}
		{\RaggedRight                             % \pbox[t]{\linewidth}  %% todo top align logo with title
		\hspace*{-10mm}\pbox[t]{0.8\linewidth}{\LARGE\bfseries \@title} \hfill	 \ifdef{\@logo}{\@logo}{}\par
		
		\ifdef{\@subtitle}{{\itshape\@subtitle}\medskip}{}
		\ifdef{\@publishers}{{\def\and{\, }\large\@publishers}\smallskip}{}
		\ifdef{\@author}{{\def\and{\, }\large\bfseries\@author}}{}
		\ifdef{\@date}{{\large\@date}}{}
		\\\smallskip
		\ \hfill\llap{\rule{\dimexpr(\linewidth+1.0cm)\relax}{\heavyrulewidth}}\\[-2ex]%
		\ \hfill\llap{\rule{\dimexpr(\linewidth-0.0pt)\relax}{\lightrulewidth}}%
}}



\def\maketitle{%
	\iftoggle{samepgTitle}{\cpb@tpSame}{\cpb@tpOwn}%
}


